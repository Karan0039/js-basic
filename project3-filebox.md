# FileBox - A Mini Dropbox Clone

## Overview:

**FileBox** is a mini Dropbox-like application that allows users to register, log in, and manage files with core functionalities such as uploading, downloading, renaming, and deleting files. These files are stored securely on AWS S3, while MongoDB is used to store file metadata. The app features secure user authentication using JSON Web Tokens (JWT).

## Table of Contents:

1. [Project Setup](#1-project-setup)
2. [API Structure](#2-api-structure)
   - [User Routes](#user-routes)
   - [File Routes](#file-routes)
3. [MongoDB Schema Design](#3-mongodb-schema-design)
4. [AWS S3 Integration](#4-aws-s3-integration)
5. [Request and Response Structure](#5-request-and-response-structure)
6. [Authentication and Security](#6-authentication-and-security)
7. [File Management Flow](#7-file-management-flow)

## 1. Project Setup

**Prerequisites:**

- Node.js
- MongoDB (cloud or local setup)
- AWS S3 Bucket and AWS credentials
- Postman or any REST API client for testing

**Dependencies**:

- Express (for building API)
- Mongoose (MongoDB ODM)
- AWS SDK (to interact with S3)
- Multer (for file uploads)
- bcrypt (for password hashing)
- JWT (for authentication)

## 2. API Structure

The app exposes the following API routes:

### User Routes:

1. **POST /register**

   - **Purpose**: Register a new user.
   - **Required Fields**: `email`, `password`
   - **Response**: Returns a success message along with the newly created user's details.

2. **POST /login**
   - **Purpose**: Log in an existing user.
   - **Required Fields**: `email`, `password`
   - **Response**: Returns a JWT token for authenticated requests.

---

### File Routes:

1. **POST /upload**

   - **Purpose**: Upload a file to AWS S3.
   - **Authentication**: JWT token required in the header.
   - **Request**: Multipart form data with the file.
   - **Response**: Returns metadata about the uploaded file.

2. **GET /download/:fileId**

   - **Purpose**: Download a specific file using the `fileId` from MongoDB.
   - **Authentication**: JWT token required.
   - **Response**: Returns a pre-signed URL for secure file download from S3.

3. **DELETE /delete/:fileId**

   - **Purpose**: Delete a specific file.
   - **Authentication**: JWT token required.
   - **Response**: Deletes the file from S3 and removes it from MongoDB.

4. **PUT /rename/:fileId**

   - **Purpose**: Rename a file.
   - **Authentication**: JWT token required.
   - **Request**: New file name as a JSON body.
   - **Response**: Updates the file metadata in MongoDB.

5. **GET /files**
   - **Purpose**: Retrieve a list of all files uploaded by the user.
   - **Authentication**: JWT token required.
   - **Response**: Returns metadata of all uploaded files for that specific user.

---

## 3. MongoDB Schema Design

### User Schema:

- **email**: `String` (required, unique)
- **password**: `String` (hashed, required)

### File Metadata Schema:

- **userId**: `ObjectId` (reference to User)
- **fileName**: `String` (original file name)
- **fileSize**: `Number` (file size in bytes)
- **fileType**: `String` (MIME type)
- **s3Key**: `String` (unique key generated by AWS S3)
- **s3Url**: `String` (S3 file URL for access)
- **uploadDate**: `Date` (timestamp)

---

## 4. AWS S3 Integration

To manage files on AWS S3, follow these steps:

1. **AWS S3 Bucket Setup**:

   - Create an S3 bucket.
   - Configure the necessary permissions (ensure only authenticated users can upload/download).

2. **AWS SDK in Node.js**:
   - Use AWS SDK to handle:
     - Uploading files
     - Generating pre-signed URLs for downloading
     - Deleting files

**Example AWS S3 Operations**:

- **File Upload**: Upload a file to a specific bucket and return the S3 URL.
- **Generate Pre-Signed URL**: Generate a temporary link (pre-signed URL) for downloading files.
- **Delete File**: Remove the file from the bucket using its key.

---

## 5. Request and Response Structure

### 1. User Registration:

**Request**:

```json
{
  "email": "user@example.com",
  "password": "password123"
}
```

**Response**:

```json
{
  "message": "User successfully registered",
  "user": {
    "email": "user@example.com",
    "userId": "617b6f55b9a85b0012f7d789"
  }
}
```

---

### 2. File Upload:

**Request**:  
Upload a file via form-data.

**Response**:

```json
{
  "message": "File uploaded successfully",
  "file": {
    "fileName": "example.png",
    "fileSize": 54321,
    "fileType": "image/png",
    "s3Url": "https://yourbucket.s3.amazonaws.com/example.png",
    "uploadDate": "2024-10-20T12:34:56.789Z"
  }
}
```

---

### 3. File Download:

**Request**:

- **Path Parameter**: `fileId`

**Response** (Pre-signed URL):

```json
{
  "url": "https://yourbucket.s3.amazonaws.com/example.png?AWSAccessKeyId=ABC&Expires=12345&Signature=XYZ"
}
```

---

### 4. Get All Files:

**Request**:

- No body required, JWT token passed in the header.

**Response**:

```json
{
  "files": [
    {
      "fileName": "example.png",
      "fileSize": 54321,
      "fileType": "image/png",
      "s3Url": "https://yourbucket.s3.amazonaws.com/example.png",
      "uploadDate": "2024-10-20T12:34:56.789Z"
    },
    {
      "fileName": "document.pdf",
      "fileSize": 12345,
      "fileType": "application/pdf",
      "s3Url": "https://yourbucket.s3.amazonaws.com/document.pdf",
      "uploadDate": "2024-10-21T09:20:12.123Z"
    }
  ]
}
```

---

## 6. Authentication and Security

- **JWT (JSON Web Token)**: Used for securing routes. Every time a user logs in, a JWT token is generated and sent to the client. This token is included in the `Authorization` header for authenticated requests.

  **Example**:

  ```
  Authorization: Bearer <JWT token>
  ```

- **Password Hashing**: Use bcrypt to securely hash user passwords before storing them in the database.

---

## 7. File Management Flow

1. **Upload Flow**:

   - User sends a file to the `/upload` endpoint.
   - The file is stored in S3, and the metadata (S3 URL, file name, etc.) is saved in MongoDB.

2. **Download Flow**:

   - User requests a file download using the `fileId`.
   - The app generates a pre-signed URL from S3, which is returned to the user for temporary download access.

3. **Delete Flow**:

   - User deletes a file using its `fileId`.
   - The file is deleted from S3, and the metadata is removed from MongoDB.

4. **Rename Flow**:

   - User requests to rename a file using its `fileId`.
   - The file's metadata in MongoDB is updated with the new name.

5. **Get Files Flow**:
   - User can fetch the list of all uploaded files for their account.
